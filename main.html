<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trang Ch·ªß | hocchoichoi</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@6.4.2/css/all.min.css">
<style>
:root {
  --primary: #4dabf7;
  --danger: #dc3545;
  --kit-bg: #f0f0f0;
  --kit-hover-bg: #e6e6e6;
  --card-shadow: 0 12px 35px rgba(0,0,0,0.25);
  --outline-color: #000;
}
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Poppins', sans-serif;
  background-color: #f8f9fc;
  color: #333;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
body::before {
  content: "";
  position: fixed; inset:0;
  background: url('https://plus.unsplash.com/premium_photo-1701454736122-14b846cfb3c3?q=80&w=1074&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') center/cover no-repeat;
  filter: blur(5px) brightness(0.55);
  z-index: -1;
}
.container {
  max-width: 1000px;
  margin: 50px auto;
  padding: 30px 40px;
  border-radius: 20px;
  background: rgba(230,230,230,0.95);
  backdrop-filter: blur(8px);
  box-shadow: 0 25px 80px rgba(0,0,0,0.35);
  border: 1px solid rgba(0,0,0,0.15);
  width: 90%;
  animation: fadeIn 0.6s ease;
}
header {
  background-color: var(--primary);
  color: white;
  text-align: center;
  padding: 20px;
  font-size: 24px;
  font-weight: bold;
  border-radius: 15px;
}
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 20px;
  justify-items: center;
  margin-top: 30px;
}
.dashboard a {
  background: var(--primary);
  color: #fff;
  text-decoration: none;
  padding: 20px;
  border-radius: 12px;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  text-align: center;
  transition: transform 0.2s, box-shadow 0.3s;
}
.dashboard a:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(77,171,247,0.7);
}
.logout-btn {
  margin: 40px auto 0 auto;
  background: var(--danger);
  color: #fff;
  border: none;
  padding: 12px 30px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  display: block;
  box-shadow: 0 4px 15px rgba(220,75,69,0.5);
  transition: transform 0.2s, box-shadow 0.3s;
}
.logout-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(220,75,69,0.7);
}
.kits { margin-top: 40px; }
.kit-row {
  display:flex; justify-content:space-between; align-items:center;
  background: var(--kit-bg); border-radius:12px; padding:12px 16px;
  margin-bottom:12px; box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  border:none; transition: box-shadow 0.2s ease, background 0.2s ease;
}
.kit-row:hover { box-shadow:0 12px 30px rgba(0,0,0,0.18); background: var(--kit-hover-bg);}
.kit-row .kit-title { font-weight:600; }
.kit-row a, .kit-row button { 
  background: var(--primary); color:#fff; border:none; padding:6px 12px; 
  border-radius:8px; cursor:pointer; font-size:14px; margin-left:8px; text-decoration:none; 
  display:inline-flex; align-items:center; gap:4px;
}
#kitSettingsModal {
  display:none; position:fixed; inset:0;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
  justify-content:center; align-items:center; z-index:999; animation:fadeIn 0.3s ease;
}
.modal-content {
  background: rgba(255,255,255,0.95); border-radius:20px;
  padding:24px 30px; width:90%; max-width:460px;
  box-shadow:0 15px 40px rgba(0,0,0,0.3); border:3px dashed var(--outline-color);
  animation: slideUp 0.4s ease;
}
.modal-content h3 { color: var(--primary); margin-bottom:16px; text-align:center; }
.modal-content label { font-weight:600; display:block; margin-top:12px; }
.modal-content input, .modal-content select {
  width:100%; border:none; border-radius:12px; padding:10px; margin-top:6px;
  font-size:15px; background: rgba(255,255,255,0.8); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.modal-buttons { margin-top:20px; display:flex; flex-wrap:wrap; justify-content:space-between; gap:8px;}
.modal-buttons button {
  flex:1; background: linear-gradient(135deg, #4dabf7, #1c7ed6);
  border:none; color:#fff; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
  transition: transform 0.2s ease;
}
.modal-buttons button:hover { transform: scale(1.05); }
button.cancel { background:#999; }
#kitCode { margin-top:14px; text-align:center; font-weight:bold; color:var(--primary);}
@keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
@keyframes slideUp { from{transform:translateY(30px);opacity:0;} to{transform:translateY(0);opacity:1;} }
</style>
</head>
<body>
<header>Trang ch·ªß</header>
<div class="container">
<h2>Ch√∫c m·ª´ng gi√°ng sinh nha, <span id="displayUsername"></span> üíñ</h2>
<p>Ch·ªçn m·ªôt n√∫t ƒë·ªÉ ti·∫øp t·ª•c:</p>
<div class="dashboard">
  <a href="about.html"><i class="fa-solid fa-chart-line"></i> Th√†nh t√≠ch h·ªçc sinh</a>
  <a href="assignments.html"><i class="fa-solid fa-clipboard-list"></i> T·∫°o b·ªô c√¢u h·ªèi</a>
  <a href="Game.html"><i class="fa-solid fa-gamepad"></i> Tr√≤ ch∆°i cho h·ªçc sinh</a>
  <a href="profile.html"><i class="fa-solid fa-user"></i> T√†i kho·∫£n c·ªßa t√¥i</a>
</div>

<div class="kits">
  <h3>B·ªô c√¢u h·ªèi ƒë√£ t·∫°o</h3>
  <div id="myKits">ƒêang t·∫£i b·ªô c√¢u h·ªèi...ch·ªù x√≠u nh√©</div>
</div>

<button class="logout-btn" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> ƒêƒÉng xu·∫•t</button>
</div>

<!-- Kit Settings Modal -->
<div id="kitSettingsModal">
<div class="modal-content">
  <h3><i class="fa-solid fa-gear"></i> C√†i ƒë·∫∑t giao nhi·ªám v·ª•</h3>
  <label>Tr·∫°ng th√°i:</label>
  <select id="assignSelect">
    <option value="Kh√¥ng Giao">Ch∆∞a giao</option>
    <option value="Giao nhi·ªám v·ª•">Giao</option>
  </select>
  <label>S·ªë ti·ªÅn h·ªçc sinh c·∫ßn ƒë·∫°t:</label>
  <input type="number" id="kitTargetMoney" min="0" value="1000">
  <div class="modal-buttons">
    <button onclick="flashcardMode()"><i class="fa-solid fa-clone"></i> √în t·∫≠p c√πng Flashcard </button>
    <button onclick="saveKitSettings()"><i class="fa-solid fa-check"></i> L∆∞u v√† t·∫°o code</button>
    <button class="cancel" onclick="closeKitSettings()"><i class="fa-solid fa-xmark"></i> ƒê√≥ng</button>
  </div>
  <div id="kitCode"></div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCd7vYlpSMcAlgwOPNBMyOhM0QIuzE-628",
  authDomain: "thaococo-70cc7.firebaseapp.com",
  projectId: "thaococo-70cc7",
  storageBucket: "thaococo-70cc7.appspot.com",
  messagingSenderId: "289749987059",
  appId: "1:289749987059:web:5ea067327247588cdc1186",
  measurementId: "G-RLNVKEF7R4"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let currentKitId = null;

// Check login
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user.uid; // ch·ªâ l∆∞u UID
    document.getElementById("displayUsername").textContent = user.email;
    loadMyKits();
  }else{
    alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p tr∆∞·ªõc!");
    window.location.href="login.html";
  }
});

// Logout
function logout(){ auth.signOut().then(()=>window.location.href='login.html'); }

// Load kits
async function loadMyKits(){
  const out = document.getElementById('myKits');
  out.innerHTML = 'ƒêang t·∫£i b·ªô c√¢u h·ªèi...';
  try{
    const snapshot = await db.collection('kits')
      .where('uid','==',currentUser)
      .orderBy('createdAt','desc')
      .get();
    if(snapshot.empty){ out.textContent='ch∆∞a c√≥ b·ªô c√¢u h·ªèi n√†o.'; return; }

    out.innerHTML='';
    snapshot.forEach(doc=>{
      const k = doc.data();
      const kitId = doc.id;
      const row = document.createElement('div');
      row.className='kit-row';
      row.innerHTML = `
        <div class="kit-title">
  ${k.title||'Untitled Kit'} (${(k.questions||[]).length} questions)
  ${k.assignedCode ? '- Code: ' + k.assignedCode : ''}
</div>
        <div style="display:flex; gap:8px;">
          <a href="assignments.html?edit=${kitId}"><i class='fa-solid fa-pen'></i> S·ª≠a</a>
          <button onclick="openKitSettings('${kitId}')"><i class='fa-solid fa-gear'></i> C√†i ƒë·∫∑t</button>
          <a href="review.html?kit=${kitId}"><i class='fa-solid fa-clone'></i> √în t·∫≠p c√πng Flashcard</a>
          <button onclick="deleteKit('${kitId}')"><i class='fa-solid fa-trash'></i> X√≥a</button>
        </div>
      `;
      out.appendChild(row);
    });
  }catch(err){ console.error(err); out.textContent='Load kits th·∫•t b·∫°i'; }
}

// Delete kit
async function deleteKit(kitId){
  if(!confirm('X√≥a b·ªô c√¢u h·ªèi n√†y vƒ©nh vi·ªÖn?')) return;
  try{
    await db.collection('kits').doc(kitId).delete();
    loadMyKits();
  }catch(err){ console.error(err); alert('X√≥a th·∫•t b·∫°i'); }
}

// Modal
async function openKitSettings(kitId){
  currentKitId = kitId;
  try{
    const doc = await db.collection('kits').doc(kitId).get();
    if(!doc.exists) return;
    const kit = doc.data();
    document.getElementById('assignSelect').value = kit.assigned || 'Kh√¥ng Giao';
    document.getElementById('kitTargetMoney').value = kit.targetMoney || 1000;
    document.getElementById('kitCode').textContent = kit.assignedCode || '';
    document.getElementById('kitSettingsModal').style.display='flex';
  }catch(err){ console.error(err); }
}

async function saveKitSettings(){
  if(!currentKitId) return;
  try{
    const docRef = db.collection('kits').doc(currentKitId);
    const assigned = document.getElementById('assignSelect').value;
    const targetMoney = parseInt(document.getElementById('kitTargetMoney').value) || 0;
    const assignedCode = Math.floor(100000 + Math.random()*900000); // 6 ch·ªØ s·ªë
    await docRef.set({assigned, targetMoney, assignedCode}, {merge:true}); // merge ƒë·ªÉ tr√°nh l·ªói
    document.getElementById('kitCode').textContent = assignedCode;
    closeKitSettings();
    loadMyKits();
    alert('L∆∞u th√†nh c√¥ng!');
  }catch(err){ console.error(err); alert('L∆∞u th·∫•t b·∫°i'); }
}
function closeKitSettings(){ document.getElementById('kitSettingsModal').style.display='none'; }

function flashcardMode(){
  if(currentKitId) window.location.href=`review.html?kit=${currentKitId}`;
}
</script>
</body>
</html>
