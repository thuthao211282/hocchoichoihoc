<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>√în Flashcard | hocchoichoihoc</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root { --primary: #4dabf7; --accent: #1971c2; --bg-light: #f8f9fc; }
* { box-sizing:border-box; margin:0; padding:0; }
body {
  font-family: 'Poppins', sans-serif;
  background: var(--bg-light);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  color:#222;
}
body::before {
  content:"";
  position:fixed; inset:0;
  background:url('https://images.unsplash.com/photo-1514377006585-6e7975371bd6?q=80&w=688&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') center/cover no-repeat;
  filter:blur(6px) brightness(0.6);
  z-index:-1;
}
header {
  width:100%;
  background: var(--primary);
  color:#fff;
  text-align:center;
  padding:18px;
  font-size:26px;
  font-weight:600;
  box-shadow:0 2px 10px rgba(0,0,0,0.3);
}
.container {
  background: rgba(255,255,255,0.92);
  border-radius: 25px;
  width:90%;
  max-width:600px;
  padding:40px;
  text-align:center;
}
.flashcard { perspective:1000px; margin:25px 0; }
.card {
  width:100%;
  height:300px;
  border-radius:20px;
  background:white;
  box-shadow:0 10px 40px rgba(0,0,0,0.25);
  position:relative;
  transform-style: preserve-3d;
  transition: transform 0.8s ease;
  cursor:pointer;
}
.card.flipped { transform:rotateY(180deg); }
.card-face {
  position:absolute;
  inset:0;
  backface-visibility:hidden;
  border-radius:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:25px;
  font-size:22px;
  font-weight:500;
  text-align:center;
  line-height:1.6;
}
.front { background:#fff; color:#212529; }
.back { background:#fff; color:var(--accent); transform:rotateY(180deg); }
.flip-hint { font-size:16px; color:#444; margin-top:10px; animation: pulse 2s infinite; }
.controls {
  display:flex;
  justify-content:space-between;
  margin-top:30px;
  flex-wrap:wrap;
  gap:12px;
}
button {
  background: var(--primary);
  color:#fff;
  border:none;
  padding:12px 20px;
  border-radius:12px;
  font-size:17px;
  cursor:pointer;
  transition: transform 0.2s;
}
button:hover { transform:scale(1.05); }
button:disabled { opacity:0.6; cursor:not-allowed; }
#backBtn { background:#868e96; }
#mainBtn { width:100%; background:#1c7ed6; margin-top:25px; font-weight:600; }
.counter { font-size:17px; font-weight:600; margin-top:8px; }
@keyframes pulse {0%,100% {opacity:0.7; transform: scale(1);} 50% {opacity:1; transform: scale(1.05);}}
</style>
</head>
<body>
<header>√în flashcard</header>
<div class="container">
  <div class="flashcard">
    <div class="card" id="flashCard">
      <div class="card-face front" id="frontText">M·∫∑t tr∆∞·ªõc</div>
      <div class="card-face back" id="backText">M·∫∑t sau</div>
    </div>
  </div>
  <div class="flip-hint"><i class="fa-solid fa-lightbulb"></i> Nh·∫•n tr·ª±c ti·∫øp v√†o th·∫ª ƒë·ªÉ l·∫≠t th·∫ª</div>
  <div class="counter" id="counter"></div>
  <div class="controls">
    <button id="prevBtn"><i class="fa-solid fa-arrow-left"></i> L√πi v·ªÅ</button>
    <button id="nextBtn">Ti·∫øp t·ª•c <i class="fa-solid fa-arrow-right"></i></button>
  </div>
  <button id="mainBtn" onclick="goBack()"><i class="fa-solid fa-house"></i> V·ªÅ l·∫°i trang ch·ªß</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCd7vYlpSMcAlgwOPNBMyOhM0QIuzE-628",
  authDomain: "thaococo-70cc7.firebaseapp.com",
  projectId: "thaococo-70cc7",
  storageBucket: "thaococo-70cc7.appspot.com",
  messagingSenderId: "289749987059",
  appId: "1:289749987059:web:5ea067327247588cdc1186",
  measurementId: "G-RLNVKEF7R4"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// L·∫•y kitId t·ª´ URL
function getQueryParam(param){
  return new URLSearchParams(window.location.search).get(param);
}
const reviewKitId = getQueryParam('kit');
let questions = [];
let index = 0;
let flipped = false;

// Load d·ªØ li·ªáu t·ª´ Firestore
async function loadKit(){
  if(!reviewKitId){
    alert("‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y b·ªô c√¢u h·ªèi!");
    window.location.href="main.html";
    return;
  }

  try{
    const doc = await db.collection('kits').doc(reviewKitId).get();
    if(!doc.exists){
      alert("‚ö†Ô∏è B·ªô c√¢u h·ªèi kh√¥ng t·ªìn t·∫°i!");
      window.location.href="main.html";
      return;
    }

    const data = doc.data();
    if(!data.questions || !data.questions.length){
      alert("‚ö†Ô∏è B·ªô c√¢u h·ªèi tr·ªëng!");
      window.location.href="main.html";
      return;
    }

    questions = data.questions.map(q => {
      let ansText = "";
      if (q.correctIndex !== undefined && q.choices) {
        ansText = q.choices[q.correctIndex];
      } else {
        ansText = "‚ö†Ô∏è Kh√¥ng c√≥ ƒë√°p √°n.";
      }
      return { question: q.question || "‚ö†Ô∏è C√¢u h·ªèi tr·ªëng", answer: ansText };
    });

    showCard();
  }catch(err){
    console.error(err);
    alert("‚ö†Ô∏è Load b·ªô c√¢u h·ªèi th·∫•t b·∫°i");
  }
}

function showCard(){
  const q = questions[index];
  document.getElementById("frontText").textContent = q.question;
  document.getElementById("backText").textContent = "üí° " + q.answer;
  document.getElementById("counter").textContent = `Th·∫ª ${index+1} / ${questions.length}`;
  document.getElementById("prevBtn").disabled = index===0;
  document.getElementById("nextBtn").disabled = index===questions.length-1;
}

// Flip card khi click
const card = document.getElementById("flashCard");
card.addEventListener("click", ()=>{
  flipped = !flipped;
  card.classList.toggle("flipped");
});

function goBack(){ window.location.href="main.html"; }

function nextCard(){
  if(index < questions.length -1){
    if(flipped){ card.classList.remove("flipped"); flipped=false; setTimeout(()=>{index++; showCard();},400);}
    else { card.classList.add("flipped"); setTimeout(()=>{card.classList.remove("flipped"); index++; showCard();},400);}
  }
}

function prevCard(){
  if(index > 0){
    if(flipped){ card.classList.remove("flipped"); flipped=false; setTimeout(()=>{index--; showCard();},400);}
    else { card.classList.add("flipped"); setTimeout(()=>{card.classList.remove("flipped"); index--; showCard();},400);}
  }
}

// Event listeners cho button
document.getElementById("nextBtn").addEventListener("click", nextCard);
document.getElementById("prevBtn").addEventListener("click", prevCard);

// Ch·ªâ load kit khi ƒë√£ login
window.addEventListener("DOMContentLoaded", ()=> {
  firebase.auth().onAuthStateChanged(user => {
    if(user){
      loadKit();
    } else {
      alert("‚ö†Ô∏è B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem b·ªô c√¢u h·ªèi!");
      window.location.href="main.html";
    }
  });
});
</script>
</body>
</html>
